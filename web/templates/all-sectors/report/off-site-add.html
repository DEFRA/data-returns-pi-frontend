{% extends 'layout/layout.html' %}

{% set value_error = (transfer.errors | selectattr2("key", "value"))  %}
{% set ewc_error = (transfer.errors | selectattr2("key", "ewc"))  %}
{% set wfd_error = (transfer.errors | selectattr2("key", "wfd"))  %}
{% set dupe_error = (transfer.errors | selectattr2("key", "off-site"))  %}

{% block content %}

<main id="content">
    <label id="page-name" hidden>off-site-add</label>
    <a href="/task-list" class="link-back">Back to sections you must complete</a>
    <form action="/transfers/off-site/add" method="post" class="form">

        <h1 class="heading-large">
            Tell us about your waste transfer
        </h1>

        {% if transfer.errors %}
        <div class="error-summary" role="alert" aria-labelledby="error-summary-heading-example-2" tabindex="-1">
            <h2 class="heading-medium error-summary-heading" id="error-summary-heading-example-2">
                Check what you’re reporting
            </h2>
            <ul class="error-summary-list">
                {% if ewc_error %}
                <li><a href=""><span class="error-message">Enter a different EWC code</span></a>
                {% endif %}

                {% if wfd_error %}
                <li><a href=""><span class="error-message">Enter a different WFD code</span></a>
                {% endif %}

                {% if value_error %}
                <li><a href=""><span class="error-message">Update your total</span></a>
                {% endif %}

                {% if dupe_error %}
                <li><a href=""><span class="error-message">You have already specified a transfer against this combination of WFD and EWC codes</span></a>
                {% endif %}
            </ul>
        </div>
        {% endif %}

        {% if ewc_error or dupe_error %}
        <div class="form-group form-group-error">
            {% if ewc_error %}
            <span class="error-message">Enter a correct EWC code</span>
            {% else %}
            <span class="error-message">Enter a different EWC code</span>
            {% endif %}
            <label class="form-label" for="ewc-code-err">EWC code</label>
			<span class="error-message">Enter a correct EWC code</span>
            <span class="form-hint">For example, ‘01 01 01’.</span>
            <input class="form-control form-control-error ewc-code" id="ewc-code-err" name="ewc" pattern="^\s*[0-9]{2} [0-9]{2} [0-9]{2}\s*$" value="{{ transfer.offSiteTransfer.ewc }}">
        </div>
        {% else %}
        <div class="form-group">
            <label class="form-label" for="ewc-code">EWC code</label>
            <span class="form-hint">For example, ‘01 01 01’.</span>
            <input class="form-control form-control ewc-code" id="ewc-code" name="ewc" pattern="^\s*[0-9]{2} [0-9]{2} [0-9]{2}\s*$" value="{{ transfer.offSiteTransfer.ewc }}">
        </div>
        {% endif %}

        {% if wfd_error or dupe_error %}
        <div class="form-group form-group-error wfd_error">
            {% if wfd_error %}
            <span class="error-message">Enter a correct WFD code</span>
            {% else %}
            <span class="error-message">Or enter a different WFD code</span>
            {% endif %}
            <label class="form-label" for="wfd-code-err">WFD code</label>
			      <span class="error-message">Enter a correct WFD code</span>
            <span class="form-hint">For example, ‘D5’ or ‘R13’.</span>
            <input class="form-control form-control-error wfd-code" id="wfd-code-err" name="wfd" value="{{ transfer.offSiteTransfer.wfd }}">
        </div>
        {% else %}
        <div class="form-group">
            <label class="form-label" for="wfd-code">WFD code</label>
            <span class="form-hint">For example, ‘D5’ or ‘R13’.</span>
            <input class="form-control wfd-code" id="wfd-code" name="wfd" value="{{ transfer.offSiteTransfer.wfd }}">
        </div>
        {% endif %}

        {% if value_error %}
        <div class="form-group form-group-error">
            <label class="form-label" for="value-err">Total</label>
			<span class="error-message">Update your total</span>
            <input type="number" step="0.001" class="form-control form-control-error total" id="value-err" name="value" value="{{ transfer.offSiteTransfer.value }}"> tonnes
        </div>
        {% else %}
        <div class="form-group">
            <label class="form-label" for="value">Total</label>
            <input type="number" step="0.001" class="form-control total" id="value" name="value" value="{{ transfer.offSiteTransfer.value }}"> tonnes
        </div>
        {% endif %}

        <div class="form-group">
            <input id="continueBtn" type="submit" class="button" value="Continue">
        </div>
    </form>

</main>

{% endblock %}
