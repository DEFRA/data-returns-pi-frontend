{% extends 'layout/layout.html' %}

{% set value_error = (transfer.errors | selectattr("key", "value"))  %}
{% set ewc_error = (transfer.errors | selectattr("key", "ewc"))  %}
{% set wfd_error = (transfer.errors | selectattr("key", "wfd"))  %}
{% set dupe_error = (transfer.errors | selectattr("key", "off-site"))  %}

{% macro errtext(errno) %}
{% if errno === 'PI-2000' %}
<span class="error-message">Value must be a number</span>
{% elif errno === 'PI-2001' %}
<span class="error-message">The EWC code is not recognised</span>
{% elif errno === 'PI-2002' %}
<span class="error-message">The WFD code is not recognised</span>
{% elif errno === 'PI-2003' %}
<span class="error-message">You have already specified a transfer against this combination of WFD and EWC codes</span>
{% else %}
<span class="error-message">Unknown error</span>
{% endif %}
{% endmacro %}

{% block content %}

<main id="content">
    <form action="/transfers/off-site/add" method="post" class="form">

        <h1 class="heading-large">
            Tell us about your waste transfer
        </h1>

        {% if transfer.errors %}
        <div class="error-summary" role="alert" aria-labelledby="error-summary-heading-example-2" tabindex="-1">
            <h2 class="heading-large error-summary-heading" id="error-summary-heading-example-2">
                Check what you’re reporting
            </h2>
            <p>There are issues with the data</p>
            <ul class="error-summary-list">
                {% if value_error %}
                <li><a href="">{{ errtext(value_error.errno) }}</a>
                {% endif %}

                {% if ewc_error %}
                <li><a href="">{{ errtext(ewc_error.errno) }}</a>
                {% endif %}

                {% if wfd_error %}
                <li><a href="">{{ errtext(wfd_error.errno) }}</a>
                {% endif %}

                {% if dupe_error %}
                <li><a href="">{{ errtext(wfd_error.errno) }}</a>
                {% endif %}
            </ul>
        </div>
        {% endif %}

        {% if ewc_error %}
        <div class="form-group form-group-error">
            <p class="bold">EWC code</p>
            <label class="form-label visually-hidden" for="ewc-code-err"></label>
            <span class="form-hint">For example, ‘13 12 01’.</span>
            <input class="form-control form-control-error ewc-code" id="ewc-code-err" name="ewc" pattern="[0-9]{2} [0-9]{2} [0-9]{2}" value="{{ transfer.offSiteTransfer.ewc }}">
            <span class="error-message">The code is not recognised</span>
        </div>
        {% else %}
        <div class="form-group">
            <p class="bold">EWC code</p>
            <label class="form-label visually-hidden" for="ewc-code"></label>
            <span class="form-hint">For example, ‘13 12 01’.</span>
            <input class="form-control ewc-code" id="ewc-code" name="ewc" pattern="[0-9]{2} [0-9]{2} [0-9]{2}" value="{{ transfer.offSiteTransfer.ewc }}">
        </div>
        {% endif %}

        {% if wfd_error %}
        <div class="form-group wfd_error">
            <p class="bold">WFD code</p>
            <label class="form-label visually-hidden" for="wfd-code-err"></label>
            <span class="form-hint">For example, ‘D5’ or ‘R13’.</span>
            <input class="form-control form-control-error wfd-code" id="wfd-code-err" name="wfd" value="{{ transfer.offSiteTransfer.wfd }}">
            <span class="error-message">The code is not recognised</span>
        </div>
        {% else %}
        <div class="form-group">
            <p class="bold">WFD code</p>
            <label class="form-label visually-hidden" for="wfd-code"></label>
            <span class="form-hint">For example, ‘D5’ or ‘R13’.</span>
            <input class="form-control wfd-code" id="wfd-code" name="wfd" value="{{ transfer.offSiteTransfer.wfd }}">
        </div>
        {% endif %}

        {% if wfd_error %}
        <div class="form-group form-group-error">
            <p class="bold">Total</p>
            <label class="form-label visually-hidden" for="value-err"></label>
            <input type="number" step="0.001" class="form-control form-control-error total" id="value-err" name="value" value="{{ transfer.offSiteTransfer.value }}"> tonnes
            <span class="error-message">Must be a number</span>
        </div>
        {% else %}
        <div class="form-group">
            <p class="bold">Total</p>
            <label class="form-label visually-hidden" for="value"></label>
            <input type="number" step="0.001" class="form-control total" id="value" name="value" value="{{ transfer.offSiteTransfer.value }}"> tonnes
        </div>
        {% endif %}

        <div class="form-group">
            <input id="continueBtn" type="submit" class="button" value="Continue">
        </div>
    </form>

</main>

{% endblock %}