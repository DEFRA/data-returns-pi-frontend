{% extends 'layout/layout.html' %}

{% block content %}

{% set value_error = (errors | selectattr2("key", "detail.value"))  %}
{% set operation_error = (errors | selectattr2("key", "detail.operation"))  %}
{% set method_error = (errors | selectattr2("key", "detail.method"))  %}

<main id="content">
    <label id="page-name" hidden>overseas</label>
    <form action="/transfers/overseas/detail" method="post" class="form">
        <a href="/task-list" class="link-back">Back to sections you must complete</a>

		<h1 class="heading-large"><span class="heading-secondary">Your overseas hazardous waste transfers</span> Your transfer of {{ transfer.substance.name }}</h1>

        {% if errors and errors.length > 0 %}
        <div class="error-summary" role="alert" aria-labelledby="check-your-report" tabindex="-1">
            <h2 class="heading-large" id="check-your-report">
                Check what youâ€™re reporting
            </h2>
            <p>There are issues with the data</p>
            <ul class="error-summary-list">
                {% if value_error %}
                <li><a href="#value-check"><span class="error-message">Correct your {{ transfer.substance.name }} total</a>
                {% endif %}

                {% if operation_error %}
                <li><a href="#operation-check"><span class="error-message">Tell us your purpose of transfer</span></a>
                {% endif %}

                {% if method_error %}
                <li><a href="#method-check"><span class="error-message">Tell us your measurement method</span></a>
                {% endif %}
            </ul>
        </div>
        {% endif %}
            <div class="grid-row">
                <div class="column-two-thirds">
                    <table class="more-detail table-control">
                        <thead> </thead>
                        <tbody>

                        <tr>
                            <th>Total</th>
                            {% if value_error %}
                            <td>
                                <div class="form-group-error">
									<span class="error-message">Enter a number</span>
                                    <label class="form-label visually-hidden" for="value-err"></label>
                                    <input class="form-control form-control-error total" id="value-err" name="value" value="{{ transfer.value }}" type="number" step="0.001"> tonnes
                                </div>
                            </td>
                            {% else %}
                            <td>
                                <label class="form-label visually-hidden" for="value"></label>
                                <input class="form-control total" id="value" name="value" value="{{ transfer.value }}" type="number" step="0.001"> tonnes
                            </td>
                            {% endif %}
                        </tr>

                        <tr>
                            <th class="unit">Purpose of transfer</th>
                            {% if operation_error %}
                            <td class="operation">
                                <div class="form-group-error">
									<span class="error-message">Tell us your purpose of transfer</span>
                                    <label class="form-label visually-hidden" for="select-box-operation">Operation</label>
                                    <select class="form-control form-control-error operation" id="select-box-operation-err" name="operationId">
                                        <option selected="">--</option>
                                        {% for operation in operations %}
                                            {% if transfer.operationId === operation.id %}
                                            <option selected value="{{ operation.id }}">{{ operation.name }}</option>
                                            {% else %}
                                            <option value="{{ operation.id }}">{{ operation.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </td>
                            {% else %}
                            <td class="operation">
                                <label class="form-label visually-hidden" for="select-box-operation">Operation</label>
                                <select class="form-control operation" id="select-box-operation" name="operationId">
                                    <option selected="">--</option>
                                    {% for operation in operations %}
                                        {% if transfer.operationId === operation.id %}
                                        <option selected value="{{ operation.id }}">{{ operation.name }}</option>
                                        {% else %}
                                        <option value="{{ operation.id }}">{{ operation.name }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </td>
                            {% endif %}
                        </tr>

                        <tr>
                            <th class="method">Method</th>

                            {% if method_error %}
                            <td class="method">
	                            <div class="form-group-error">
									<span class="error-message">Tell us your measurement method</span>
                                    <label class="form-label visually-hidden" for="select-box-method-err">Method</label>
                                    <select class="form-control form-control-error method" id="select-box-method-err" name="methodId">
                                        <option>--</option>
                                        {% for method in methods %}
                                        {% if transfer.methodId === method.id %}
                                        <option selected value="{{ method.id }}">{{ method.name }}</option>
                                        {% else %}
                                        <option value="{{ method.id }}">{{ method.name }}</option>
                                        {% endif %}
                                        {% endfor %}
                                    </select>
	                            </div>
                            </td>
                            {% else %}
                            <td class="method">
                                <label class="form-label visually-hidden" for="select-box-method">Method</label>
                                <select class="form-control method" id="select-box-method" name="methodId">
                                    <option>--</option>
                                    {% for method in methods %}
                                    {% if transfer.methodId === method.id %}
                                    <option selected value="{{ method.id }}">{{ method.name }}</option>
                                    {% else %}
                                    <option value="{{ method.id }}">{{ method.name }}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                            </td>
                            {% endif %}
                        </tr>

                        </tbody>
                    </table>
                    <div class="form-group"> <input type="submit" class="button" value="Continue"> </div>
                </div>
            </div>
    </form>

</main>

{% endblock %}
