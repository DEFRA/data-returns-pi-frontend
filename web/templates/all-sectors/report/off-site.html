{% extends 'layout/layout.html' %}

{% block content %}
<main id="content">
    <label id="page-name" hidden>off-site</label>

    {% if transfers | map("errors") | length === 0 %}
    <h1 class="heading-large">Report your off-site waste transfers</h1>
    {% else %}
    <div class="error-summary" role="alert" aria-labelledby="error-summary-heading-example-2" tabindex="-1">
        <h2 class="heading-large error-summary-heading" id="error-summary-heading-example-2">Check what youâ€™re reporting</h2>
        <p>You must enter a number.</p>
        <ul class="error-summary-list">
            {% for transfer in transfers | transfersWithErrors %}
            <li><a href="#">Change your total for {{ transfer | transferShortDesc }} </a></li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <form action="/transfers/off-site/action" method="post" class="form">
        <input class="link link-back" type="submit" id="back" name="back" value="Back to tasks"/>

        <table class="check-data table-control mobile-format">
            <thead>
            <tr>
                <th class="th-ewc-code">EWC code</th>
                <th class="th-waste">Waste</th>
                <th class="th-wfd-code">WFD code</th>
                <th class="th-total">Total</th>
                <th class="th-more-detail"><span class="visually-hidden">More detail</span></th>
                <th class="th-delete"><span class="visually-hidden">Delete</span></th>
            </tr>
            </thead>
            <tbody>
            {% for transfer in transfers %}
            <tr>
                <td class="td-ewc-code">{{ transfer.ewc.activity.activity }} {{ transfer.ewc.chapter.chapter }} {{ transfer.ewc.subChapter.subChapter }}</td>

                <td class="td-ewc-code">{{ transfer.ewc.subChapter.description }}</td>

                {% if transfer.wfd.disposal %}
                <td class="td-wfd-code">{{ transfer.wfd.disposal.code }}</td>
                {% elif transfer.wfd.recovery %}
                <td class="td-wfd-code">{{ transfer.wfd.recovery.code }}</td>
                {% endif %}

                {% set value_error = (transfer.errors | selectattr2("key", "value"))  %}
                {% if value_error %}
                <td class="td-total">
                    <label class="form-label visually-hidden" for="value-err">Total</label>
                    <input class="form-control form-control-error" id="value-err" name="value-{{ loop.index0 }}" type="number" step="0.001" value="{{ transfer.value }}"> tonnes
                </td>
                {% else %}
                <td class="td-total">
                    <label class="form-label visually-hidden" for="value">Total</label>
                    <input class="form-control" id="value" name="value-{{ loop.index0 }}" type="number" step="0.001" value="{{ transfer.value }}"> tonnes
                </td>
                {% endif %}

                <td>
                    <input class="link" type="submit" id="detail" name="detail-{{ loop.index0 }}" value="More detail"/>
                </td>

                <td>
                    <input class="link" type="submit" id="delete" name="delete-{{ loop.index0 }}" value="Delete"/>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>

        <div class="form-group">
            <input class="link" type="submit" id="add" name="add" value="Add a new off-site waste transfer"/>
        </div>

        <div class="form-group">
            <input class="button" type="submit" id="continueBtn" name="continue" value="Continue"/>
        </div>
    </form>

</main>

{% endblock %}